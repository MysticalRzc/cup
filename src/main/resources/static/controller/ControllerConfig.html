<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>cup----接口配置</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <script src="../js/jquery-1.4.1.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="../layui/css/layui.css" media="all">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/smalot-bootstrap-datetimepicker/2.4.4/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/smalot-bootstrap-datetimepicker/2.4.4/js/bootstrap-datetimepicker.min.js"></script>
    <script src="https://cdn.bootcss.com/smalot-bootstrap-datetimepicker/2.4.4/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
    <script type="text/javascript" src="../layui/layui.js" charset="utf-8"></script>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo"><a href="#"  onclick="menuClick('../main.html')">layui 后台布局</a></div>
        <!-- 头部区域（可配合layui已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item"><a href="">控制台</a></li>
            <li class="layui-nav-item"><a href="">商品管理</a></li>
            <li class="layui-nav-item"><a href="">用户</a></li>
            <li class="layui-nav-item">
                <a href="javascript:;">其它系统</a>
                <dl class="layui-nav-child">
                    <dd><a href="">邮件管理</a></dd>
                    <dd><a href="">消息管理</a></dd>
                    <dd><a href="">授权管理</a></dd>
                </dl>
            </li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="javascript:;">
                    <img src="//tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg"
                         class="layui-nav-img">
                    Mystical
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="">基本资料</a></dd>
                    <dd><a href="">安全设置</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item"><a href="">退了</a></li>
        </ul>
    </div>

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree" lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed">
                    <a href="javascript:;">cup</a>
                    <dl class="layui-nav-child">
                        <dd><a href="#" onclick="menuClick('ControllerConfig.html')">接口配置</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">解决方案</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;">列表一</a></dd>
                        <dd><a href="javascript:;">列表二</a></dd>
                        <dd><a href="">超链接</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item"><a href="">云市场</a></li>
                <li class="layui-nav-item"><a href="">发布商品</a></li>
            </ul>
        </div>
    </div>
    <!--==================================================================================================================================-->
    <!--=====================================================layui-body===================================================================-->

    <div class="layui-body">
        <br>
        <div class="layui-form-item">
            <div class="form-inline" >
                <label for="requestUrl">&nbsp;接口地址</label>
                <input type="text" class="form-control" id="requestUrl" style="width: 150px; height: 30px;" placeholder="请输入接口地址">
                <label for="creator">创建人</label>
                <input type="text" class="form-control" id="creator" style="width: 150px; height: 30px;" placeholder="请输入创建人">
                <label for="dateBeginTime">开始时间</label>
                <input id="dateBeginTime" class="form-controls" value="请选择日期" readonly>
                <label for="dateEndTime">结束时间</label>
                <input id="dateEndTime" class="form-controls" value="请选择日期" readonly>&nbsp;
                <button class="layui-btn" onclick="search()">搜 索</button>
                <button class="layui-btn" data-toggle="modal" onclick="editAddress(this)"  data-target="#addItemModel" >增 加</button>
            </div>
        </div>
        <div class="layui-form">
            <table class="layui-table" id="ctlTable">
                <colgroup>
                    <col width="5%">
                    <col width="10%">
                    <col width="15%">
                    <col width="15%">
                    <col width="5%">
                    <col width="5%">
                    <col width="5%">
                    <col width="5%">
                    <col width="7%">
                    <col width="7%">
                    <col width="10%">
                </colgroup>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>接口地址</th>
                    <th>输入参数</th>
                    <th>输出参数</th>
                    <th>请求方式</th>
                    <th>AK</th>
                    <th>SK</th>
                    <th>描述</th>
                    <th>创建时间</th>
                    <th>修改时间</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                </tr>
                </tbody>
            </table>
        </div>
        <div id="pageItem"></div>
        <script>
            function search(){
                var request = new Object();
                request.controllerUrl = document.getElementById("requestUrl").value;
                request.creator = document.getElementById("creator").value;
                request.beginTime = document.getElementById("dateBeginTime").value;
                request.endTime = document.getElementById("dateEndTime").value;
                $.ajax({
                    type: 'POST',
                    url: 'http://47.105.105.78:10151/cup/controller/search',
                    data: JSON.stringify(request),
                    contentType : "application/json;charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if(data.retCode == "0000"){
                            var tb = document.getElementById('ctlTable');
                            var rowNum = tb.rows.length;
                            for (i = 2; i < rowNum; i++) {
                                tb.deleteRow(i);
                                rowNum = rowNum - 1;
                                i = i - 1;
                            }
                            data.retData.data.forEach(addRow);
                        }
                    }
                });
            }
            function  makePage(total) {
                layui.use(['laypage', 'layer'], function () {
                    var laypage = layui.laypage
                        , layer = layui.layer;
                    //完整功能
                    laypage.render({
                        elem: 'pageItem'
                        , count: total
                        , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
                        , jump: function (obj,first) {
                            var tb = document.getElementById('ctlTable');
                            var rowNum = tb.rows.length;
                            for (i = 2; i < rowNum; i++) {
                                tb.deleteRow(i);
                                rowNum = rowNum - 1;
                                i = i - 1;
                            }
                            getControllerData(obj.curr, obj.limit);
                        }
                    });
                });
            }
            function getControllerData(page,limit,first) {
                $.ajax({
                    type: 'POST',
                    url: 'http://47.105.105.78:10151/cup/controller/list',
                    data: {'page': page, 'limit': limit},
                    dataType: "json",
                    success: function (data) {
                        if(first===1){
                            makePage(data.retData.count);
                        }
                        data.retData.data.forEach(addRow);
                    }
                });
            }
            getControllerData(1,1,1);
            function addRow(obj) {
//添加行
                var newTr = ctlTable.insertRow();
//添加列
                var newTd0 = newTr.insertCell();
                var newTd1 = newTr.insertCell();
                var newTd2 = newTr.insertCell();
                var newTd3 = newTr.insertCell();
                var newTd4 = newTr.insertCell();
                var newTd5 = newTr.insertCell();
                var newTd6 = newTr.insertCell();
                var newTd7 = newTr.insertCell();
                var newTd8 = newTr.insertCell();
                var newTd9 = newTr.insertCell();
                var newTd10 = newTr.insertCell();
//设置列内容和属性
                newTd0.innerText = obj.id;
                newTd1.innerText = obj.controllerUrl;
                newTd2.innerText = obj.inputParam;
                newTd3.innerText = obj.outputParam;
                newTd4.innerText = obj.type;
                newTd5.innerText = obj.ak;
                newTd6.innerText = obj.sk;
                newTd7.innerText = obj.decription;
                newTd8.innerText = timestampToTime(obj.createTime);
                newTd9.innerText = timestampToTime(obj.updateTime);
                newTd10.innerHTML = '<button class="layui-btn layui-btn-sm" data-toggle="modal" onclick="editAddress(this)"  data-target="#updateItemModel" >编辑</button><button class="layui-btn layui-btn-sm" onclick="deleteLine(this)">删除</button>';
            }
            $(function() {
                $(".form-controls").datetimepicker({
                    format : 'yyyy-mm-dd hh', // 展现格式
                    startDate : "2010-01-01",// 开始时间
                    endDate : "2020-01-01", // 结束时间
                    autoclose : true, // 选择日期后关闭
                    // 选择器打开之后首先显示的视图
                    // 0表示分钟(默认),1表示小时,2表示天,3表示月,4表示年
                    startView : 2,
                    // 选择器所能够提供的最精确的时间选择视图
                    // 0表示分钟(默认),1表示小时,2表示天,3表示月,4表示年
                    minView : 1,
                    language : 'zh-CN', //显示语言为中文
                });
            });

            function timestampToTime(time) {
                var timestamp = JSON.stringify(time)
                var Y = timestamp.substring(1,5);
                var M = timestamp.substring(6,8);
                var D = timestamp.substring(9,11);
                var h = timestamp.substring(12,14);
                var m = timestamp.substring(15,17);
                var s = timestamp.substring(18,20);
                return Y+ "-" +M+ "-" +D+ " " +h+ ":" +m+ ":" +s;
            }

            function deleteLine(obj) {
                if(window.confirm('你确定要删除吗？')){
                    var requestParam = new Object();
                    var name = $(obj).parent().parent().find('td')[0];//通过parent()方法返回被选元素的直接父元素,找到第一个P标签。
                    var id = $(name).text();      //获取P标签中的内容
                    requestParam.id = id
                    requestParam.creator = "admin";
                    requestParam.tocken = "asdfasdfasfd";
                    $.ajax({
                        type: 'POST',
                        url: 'http://47.105.105.78:10151/cup/controller/delete',
                        data: JSON.stringify(requestParam),
                        contentType : "application/json;charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            alert(JSON.stringify(data.retMsg))
                            var t = document.getElementById('ctlTable');
                            t.deleteRow(obj.parentNode.parentNode.rowIndex)
                        },
                        error:function(){
                            alert("删除失败")
                        }
                    });

                    return true;
                }else{
                    return false;
                }

            }
            function guid() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                        return v.toString(16);
                });
            }
            function updateController(obj){
                var requestParam = new Object();
                requestParam.id = document.getElementById("controllerId").value;
                requestParam.requestUrl = document.getElementById("updateUrl").value;
                requestParam.requestParam = document.getElementById("updateReuqestParam").value;
                requestParam.responseParam = document.getElementById("updateResponseParam").value;
                requestParam.requestType = document.getElementById("updateType").value;
                requestParam.ak = document.getElementById("updateAK").value;
                requestParam.sk = document.getElementById("updateSK").value;
                requestParam.desc = document.getElementById("updateDesc").value;
                requestParam.creator = "admin";
                requestParam.tocken = "asdfasdfasfd";
                $.ajax({
                    type: 'POST',
                    url: 'http://47.105.105.78:10151/cup/controller/update',
                    data: JSON.stringify(requestParam),
                    contentType : "application/json;charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        alert(JSON.stringify(data.retMsg))
                        window.location.reload();
                    },
                    error:function(){
                        alert("修改失败")
                    }
                });
            }
            function addController(obj){
                var requestParam = new Object();
                requestParam.id = document.getElementById("controllerId").value;
                requestParam.requestUrl = document.getElementById("addUrl").value;
                requestParam.requestParam = document.getElementById("addReuqestParam").value;
                requestParam.responseParam = document.getElementById("addResponseParam").value;
                requestParam.requestType = document.getElementById("addType").value;
                requestParam.ak = document.getElementById("addAK").value;
                requestParam.sk = document.getElementById("addSK").value;
                requestParam.desc = document.getElementById("addDesc").value;
                requestParam.creator = "admin";
                requestParam.tocken = "asdfasdfasfd";
                $.ajax({
                    type: 'POST',
                    url: 'http://47.105.105.78:10151/cup/controller/add',
                    data: JSON.stringify(requestParam),
                    contentType : "application/json;charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        alert(JSON.stringify(data.retMsg))
                        window.location.reload();
                    },
                    error:function(){
                        alert("修改失败")
                    }
                });
            }

            function  showInfo(o) {
                alert(o.innerHTML)
            }
            function editAddress(obj) {
                var name = $(obj).parent().parent().find('td')[0];//通过parent()方法返回被选元素的直接父元素,找到第一个P标签。
                var id = $(name).text();      //获取P标签中的内容
                $("#controllerId").val(id);	      //赋值给模态框中的input
                var name = $(obj).parent().parent().find('td')[1];//通过parent()方法返回被选元素的直接父元素,找到第一个P标签。
                var url = $(name).text();      //获取P标签中的内容
                $("#updateUrl").val(url);	      //赋值给模态框中的input
                var name = $(obj).parent().parent().find('td')[2];
                var inputParam = $(name).text();
                $("#updateReuqestParam").val(inputParam);
                var name = $(obj).parent().parent().find('td')[3];
                var outPutparam = $(name).text();
                $("#updateResponseParam").val(outPutparam);
                var name = $(obj).parent().parent().find('td')[4];
                var desc = $(name).text();
                $("#updateType").val(desc);
                var name = $(obj).parent().parent().find('td')[5];
                var desc = $(name).text();
                $("#updateAK").val(desc);
                var name = $(obj).parent().parent().find('td')[6];
                var desc = $(name).text();
                $("#updateSK").val(desc);
                var name = $(obj).parent().parent().find('td')[7];
                var desc = $(name).text();
                $("#updateDesc").val(desc);
            }
        </script>
    </div>

    <!--==================================================================================================================================-->
    <!--=====================================================layui-footer=================================================================-->
    <div class="layui-footer">
         Quickly---Cup
        © Mystical
    </div>
    <div class="modal fade" id="updateItemModel" tabindex="-1" role="dialog" aria-labelledby="updateItemModel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title">
                        更改接口配置
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="form-inline" >
                        <label>id:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                        <input type="text" class="form-control" id="controllerId" style="width: 400px; height: 30px;" readonly="readonly"> <br><br>
                        <label>接口地址:</label>
                        <input type="text" class="form-control" id="updateUrl" style="width: 400px; height: 30px;" placeholder="请输入接口地址"><br><br>
                        <label for="updateReuqestParam">输入参数:</label>
                        <textarea  type="text" class="form-control" id="updateReuqestParam" style="width: 400px; height: 100px;" placeholder="请输入输入参数"></textarea><br><br>
                        <label for="updateResponseParam">输出参数:</label>
                        <textarea  type="text" class="form-control" id="updateResponseParam" style="width: 400px; height: 100px;" placeholder="请输入输出参数"></textarea><br><br>
                        <label for="updateType">请求方式:</label>
                            <select class="form-control" data-example-ids="select-form-control" class="form-control" id="updateType" style="width: 400px; height: 30px;" placeholder="postMethod">
                                <option>通用</option>
                                <option>POST</option>
                                <option>GET</option>
                            </select>
                        <!--<input type="text" class="form-control" id="updateType" style="width: 400px; height: 30px;" placeholder="postMethod">--><br><br>
                        <label for="updateAK">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;K&nbsp;&nbsp;:</label>
                        <input type="text" class="form-control" id="updateAK" style="width: 400px; height: 30px;" placeholder="AK"><br><br>
                        <label for="updateSK">S &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;K&nbsp;&nbsp;:</label>
                        <input type="text" class="form-control" id="updateSK" style="width: 400px; height: 30px;" placeholder="SK"><br><br>
                        <label for="updateDesc">描 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;述 :</label>
                        <input type="text" class="form-control" id="updateDesc" style="width: 400px; height: 30px;" placeholder="描述"><br><br>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <button type="button" class="btn btn-primary" onclick="updateController(this)">
                        提交更改
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
    <div class="modal fade" id="addItemModel" tabindex="-1" role="dialog" aria-labelledby="addItemModel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title">
                        添加新接口
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="form-inline" >
                        <label>接口地址:</label>
                        <input type="text" class="form-control" id="addUrl" style="width: 400px; height: 30px;" placeholder="请输入接口地址"><br><br>
                        <label for="addReuqestParam">输入参数:</label>
                        <textarea  type="text" class="form-control" id="addReuqestParam" style="width: 400px; height: 100px;" placeholder="请输入输入参数"></textarea><br><br>
                        <label for="addResponseParam">输出参数:</label>
                        <textarea  type="text" class="form-control" id="addResponseParam" style="width: 400px; height: 100px;" placeholder="请输入输出参数"></textarea><br><br>
                        <label for="addType">请求方式:</label>
                        <select class="form-control" data-example-ids="select-form-control" class="form-control" id="addType" style="width: 400px; height: 30px;" placeholder="postMethod">
                            <option>通用</option>
                            <option>POST</option>
                            <option>GET</option>
                        </select>
                        <br><br>
                        <label for="addAK">A &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;K :</label>
                        <input type="text" class="form-control" id="addAK" style="width: 400px; height: 30px;" placeholder="AK"><br><br>
                        <label for="addSK">S &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;K :</label>
                        <input type="text" class="form-control" id="addSK" style="width: 400px; height: 30px;" placeholder="SK"><br><br>
                        <label for="addDesc">描 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;述 :</label>
                        <input type="text" class="form-control" id="addDesc" style="width: 400px; height: 30px;" placeholder="描述"><br><br>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <button type="button" class="btn btn-primary" onclick="addController(this)">
                        保存接口
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
</div>
<script>
    //JavaScript代码区域
    layui.use('element', function(){
        var element = layui.element;
    });
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?d214947968792b839fd669a4decaaffc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
    var menuClick = function(menuUrl) {
        top.location.href =menuUrl;
    };
</script>
</body>
</html>
